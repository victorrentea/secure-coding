<html>
<head>
    <link href="../toastr.min.css" rel="stylesheet"/>
    <script type="text/javascript" src="../jquery-1.12.2.min.js"></script>
    <script type="text/javascript" src="../toastr.min.js"></script>
</head>
<body>
<h2>Cross-Origin Resource Sharing (CORS)</h2>
<div style="border:2px solid green">
    <h4>Transfer Money (via JS call, aka AJAX)</h4>
    Recipient Full Name:<input type="text" id="fullName" value="John Doe"/> <br/>
    Recipient IBAN number:<input type="text" id="iban" value="12345678900"/> <br/>
    Amount:<input type="text" id="amount" value="100"/> <br/>
    <input type="button" value="Transfer" onclick="transferAmount()">
</div>

<script type="text/javascript">

    function transferAmount() {
        // var restEndpoint = "http://localhost/api/victim/transfer-rest"; // to test CORS using a local NodeJS instance
        var restEndpoint = "http://localhost:8080/api/victim/transfer-rest";

        const payload = {
            recipientFullName: document.getElementById("fullName").value,
            recipientIban: document.getElementById("iban").value,
            amount: document.getElementById("amount").value
        };

        fetch(restEndpoint, {
            method: "POST",
            credentials: "include", // include cookies/credentials for CORS requests
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(payload)
        })
        .then(response => {
            if (!response.ok) {
                return response.text().then(text => { throw new Error(text || response.statusText); });
            }
            // try parse JSON, but don't fail if empty
            return response.json().catch(() => null);
        })
        .then(data => {
            toastr.success("Money Transferred");
        })
        .catch(error => {
            console.error("Transfer failed:", error);
            toastr.error("Failed to transfer: " + (error.message || ""));
        });
    }
</script>
</body>
</html>
